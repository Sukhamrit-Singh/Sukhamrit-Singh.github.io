<!DOCTYPE html>
<html>
<head>
    <title>Project 1 - CS180</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
            line-height: 1.8;
            color: #e0e0e0;
            background: #0a0a0a;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 60px 80px;
        }

        h1 {
            font-size: 2.5em;
            font-weight: 300;
            letter-spacing: -1px;
            color: #ffffff;
            margin-bottom: 8px;
        }

        .subtitle {
            font-size: 1em;
            color: #808080;
            margin-bottom: 60px;
            font-weight: 400;
        }

        .author {
            color: #606060;
            margin: 10px 0;
            font-size: 1em;
        }

        h2 {
            color: #ffffff;
            font-size: 1.8em;
            font-weight: 300;
            margin: 80px 0 40px;
            letter-spacing: -0.5px;
        }

        h3 {
            color: #c0c0c0;
            font-size: 1.3em;
            font-weight: 300;
            margin: 40px 0 20px;
        }

        p {
            color: #a0a0a0;
            margin-bottom: 20px;
            line-height: 1.8;
        }

        ul, ol {
            color: #a0a0a0;
            margin-left: 30px;
            margin-bottom: 20px;
        }

        li {
            margin-bottom: 8px;
        }

        code {
            background: #1a1a1a;
            color: #80ff80;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: inherit;
        }

        .image-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            margin: 40px 0;
        }

        .image-wrapper {
            margin-bottom: 20px;
        }

        .image-container {
            position: relative;
            overflow: hidden;
            background: #1a1a1a;
            border-radius: 4px;
            transition: transform 0.2s ease;
        }

        .image-container:hover {
            transform: scale(1.02);
        }

        .image-container img {
            width: 100%;
            height: auto;
            display: block;
            opacity: 0.9;
            transition: opacity 0.2s ease;
        }

        .image-container:hover img {
            opacity: 1;
        }

        .image-caption {
            color: #ffffff;
            font-size: 0.95em;
            margin-top: 10px;
            text-align: center;
        }

        .offset-info {
            font-size: 0.85em;
            color: #606060;
            margin-top: 4px;
            text-align: center;
        }

        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 40px 0;
        }

        .comparison-item {
            text-align: center;
        }

        .comparison-item img {
            width: 100%;
            border-radius: 4px;
            margin-bottom: 10px;
        }

        .comparison-label {
            color: #808080;
            font-size: 0.9em;
        }

        .algorithm-box {
            background: #1a1a1a;
            border-left: 3px solid #404040;
            padding: 20px;
            margin: 30px 0;
            border-radius: 4px;
        }

        .highlight {
            background: #1a1a1a;
            border-left: 3px solid #ffff00;
            padding: 20px;
            margin: 30px 0;
            border-radius: 4px;
        }

        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin: 40px 0;
        }

        .results-table th {
            background: #1a1a1a;
            color: #ffffff;
            padding: 12px;
            text-align: left;
            font-weight: 400;
        }

        .results-table td {
            padding: 10px;
            border-bottom: 1px solid #2a2a2a;
            color: #a0a0a0;
        }

        .results-table tr:hover {
            background: #151515;
        }

        .back-button {
            position: fixed;
            top: 20px;
            left: 20px;
            background: #1a1a1a;
            border: 1px solid #404040;
            color: #808080;
            padding: 8px 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.2s ease;
            z-index: 1000;
            font-size: 14px;
        }
        
        .back-button:hover {
            background: #2a2a2a;
            color: #ffffff;
            border-color: #606060;
        }

        @media (max-width: 768px) {
            .container {
                padding: 40px;
            }
            
            .image-grid {
                grid-template-columns: 1fr;
            }
            
            .comparison {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <a href="./index.html" class="back-button" title="Back to portfolio">
        <span style="font-size: 14px;">../</span>
    </a>
    
    <div class="container">
        <div style="margin-bottom: 60px;">
            <h1 style="margin-bottom: 20px;">proj1/</h1>
            <div style="margin-left: 40px;">
                <div style="margin: 8px 0;">
                    <a href="#overview" style="color: #808080; text-decoration: none; transition: color 0.2s ease;">
                        <span style="color: #404040;">├── </span>
                        <span style="color: #ffffff;">overview/</span>
                        <span style="color: #606060; margin-left: 8px;">Colorizing the Prokudin-Gorskii Photo Collection</span>
                    </a>
                </div>
                <div style="margin: 8px 0;">
                    <a href="#single-scale" style="color: #808080; text-decoration: none; transition: color 0.2s ease;">
                        <span style="color: #404040;">├── </span>
                        <span style="color: #ffffff;">single_scale_alignment/</span>
                        <span style="color: #606060; margin-left: 8px;">L2 Distance Method</span>
                    </a>
                </div>
                <div style="margin: 8px 0;">
                    <a href="#multi-scale" style="color: #808080; text-decoration: none; transition: color 0.2s ease;">
                        <span style="color: #404040;">├── </span>
                        <span style="color: #ffffff;">multi_scale_pyramid/</span>
                        <span style="color: #606060; margin-left: 8px;">NCC with Image Pyramids</span>
                    </a>
                </div>
                <div style="margin: 8px 0;">
                    <a href="#additional" style="color: #808080; text-decoration: none; transition: color 0.2s ease;">
                        <span style="color: #404040;">├── </span>
                        <span style="color: #ffffff;">additional/</span>
                        <span style="color: #606060; margin-left: 8px;">Extra Examples from the Collection</span>
                    </a>
                </div>
                <div style="margin: 8px 0;">
                    <a href="#bells" style="color: #808080; text-decoration: none; transition: color 0.2s ease;">
                        <span style="color: #404040;">├── </span>
                        <span style="color: #ffffff;">bells_and_whistles/</span>
                        <span style="color: #606060; margin-left: 8px;">Sobel Edge Detection</span>
                    </a>
                </div>
                <div style="margin: 8px 0;">
                    <a href="#summary" style="color: #808080; text-decoration: none; transition: color 0.2s ease;">
                        <span style="color: #404040;">└── </span>
                        <span style="color: #ffffff;">summary/</span>
                        <span style="color: #606060; margin-left: 8px;">Results Table & Conclusions</span>
                    </a>
                </div>
            </div>
        </div>

        <h1 style="font-size: 2.5em; margin-bottom: 10px;">Images of the Russian Empire</h1>
        <div style="color: #808080; margin-bottom: 40px; font-size: 1em;">Colorizing the Prokudin-Gorskii Photo Collection</div>

        <h2 id="overview">Overview</h2>
        <p>
            Sergei Mikhailovich Prokudin-Gorskii was a photographer who captured the Russian Empire in color 
            decades before color photography became widespread. His technique involved taking three separate 
            exposures through red, green, and blue filters on glass plates. This project implements an algorithm 
            to automatically align these images using metrics such as Euclidian Distance or Normalized Cross-Correlation, 
            and then combine these three channel images into full-color photographs, displaying the vibrant images 
            that were taken nearly a century ago.
        </p>

        <div style="background: linear-gradient(90deg, #1a1a1a 0%, transparent 100%); padding: 20px; margin: 60px -20px 40px; border-left: 3px solid #40ff40;">
            <h2 id="single-scale" style="margin: 0; color: #40ff40;">Part 1: Single-Scale Alignment</h2>
            <div style="color: #808080; font-size: 0.9em; margin-top: 5px;">Using L2 (Euclidean) Distance for Low-Resolution Images</div>
        </div>
        
        <h3>Implementation Approach</h3>
        <p>
            For the single-scale alignment, I implemented an exhaustive search approach specifically for the low-resolution 
            images (cathedral.jpg, monastery.jpg, tobolsk.jpg). The algorithm searches over a window of -15 to 15 pixels 
            using the L2 (Euclidean) distance metric as the similarity measure. I found the optimal shift values by minimizing 
            the L2 distance metric, and after calculating optimal Euclidian Distances, I used <code>np.roll</code> to align the 
            images using the optimal shifts we detected.
        </p>
        
        <h3>Handling Border Artifacts</h3>
        <p>
            The initial alignment however was not perfect due to the black borders present in the original glass plate scans. 
            To address this, I implemented a 10% crop from all edges before computing the alignment metrics. This 
            preprocessing step significantly improved the L2-based alignment quality for the single-scale approach.
        </p>
        <div class="comparison">
            <div class="comparison-item">
                <img src="proj1/unoptimal2.png" alt="Uncropped Example 1">
                <div class="comparison-label">Uncropped Example 1</div>
            </div>
            <div class="comparison-item">
                <img src="proj1/unoptimal3.png" alt="Uncropped Example 2">
                <div class="comparison-label">Uncropped Example 2</div>
            </div>
        </div>

        <h3>Single-Scale Results</h3>
        <div class="image-grid">
            <div class="image-wrapper">
                <div class="image-container">
                    <img src="proj1/cathedral.jpeg" alt="Cathedral">
                </div>
                <div class="image-caption">Cathedral</div>
                <div class="offset-info">B: (-5, -2) | R: (7, 1)</div>
            </div>
            <div class="image-wrapper">
                <div class="image-container">
                    <img src="proj1/monastery.jpeg" alt="Monastery">
                </div>
                <div class="image-caption">Monastery</div>
                <div class="offset-info">B: (3, -2) | R: (6, 1)</div>
            </div>
            <div class="image-wrapper">
                <div class="image-container">
                    <img src="proj1/tobolsk.jpeg" alt="Tobolsk">
                </div>
                <div class="image-caption">Tobolsk</div>
                <div class="offset-info">B: (-3, -3) | R: (4, 1)</div>
            </div>
        </div>

        <div style="background: linear-gradient(90deg, #1a1a1a 0%, transparent 100%); padding: 20px; margin: 60px -20px 40px; border-left: 3px solid #4080ff;">
            <h2 id="multi-scale" style="margin: 0; color: #4080ff;">Part 2: Multi-Scale Pyramid Alignment</h2>
            <div style="color: #808080; font-size: 0.9em; margin-top: 5px;">Using NCC with Image Pyramids for High-Resolution Images</div>
        </div>

        <h3>Transitioning to NCC and Pyramids</h3>
        <p>
            For high-resolution images, the single-scale approach was computationally expensive and less accurate. 
            To avoid this, I implemented a multi-scale pyramid approach with the following key improvements:
        </p>
        <ul>
            <li><strong>Normalized Cross-Correlation (NCC):</strong> Switched from L2 distance to NCC, which is more robust 
            to brightness variations between color channels</li>
            <li><strong>Image Pyramids:</strong> Downsamples each BGR channel by a factor of 2 to create multiple resolution levels</li>
            <li><strong>Adaptive Search Windows:</strong> Used -30 to 30 pixels at the coarsest level, then ±2 pixels 
            at finer levels for refinement</li>
            <li><strong>Increased Cropping:</strong> Extended border cropping from 10% to 15% for better border frame removal</li>
            <li><strong>Green Channel Reference:</strong> Aligned both B and R channels to G rather than alinging to B. I noticed 
            this method improved alignment to make the resulting image about perfectly aligned</li>
        </ul>
        
        <h3>Image Pyramid Algorithm Process</h3>
        <p>
            The pyramid alignment process works iteratively. Starting with the original high-resolution image, I downsample 
            it by factors of 2 in a loop until reaching a minimum size of 256x256. At the coarsest level, I perform 
            an exhaustive search over a larger window (-30 to 30 pixels) using NCC to find the best alignment. This coarse 
            alignment is then propagated up to the next level by scaling the offsets by 2. At each finer level, I only need 
            to search within ±2 pixels of the scaled estimate, dramatically reducing computation time while maintaining accuracy.
        </p>
        <p>
            The NCC metric itself computes the normalized dot product between two image patches, making it more invariant to 
            differences in brightness and contrast. By aligning both the 
            blue and red channels to the green channel (instead of aligning to the blue channel), I ensure that any alignment errors don't 
            compound, resulting in more consistent and accurate color reconstruction across all images.
        </p>
        
        <h3>The Emir Challenge - Comparing Methods</h3>
        <p>
            After making the above changes, the alignment of the Emir image particularly demonstrated the superiority of using the G channel to align 
            rather than the B channel.
        </p>
        <div class="comparison">
            <div class="comparison-item">
                <img src="proj1/emir_wrong.png" alt="Emir with pixel-based alignment">
                <div class="comparison-label">Blue Channel Alignment</div>
            </div>
            <div class="comparison-item">
                <img src="proj1/emir.jpeg" alt="Emir with edge-based alignment">
                <div class="comparison-label">Green Channel Alignment</div>
            </div>
        </div>

        <h3>Multi-Scale Pyramid Results</h3>
        <div class="image-grid">
            <div class="image-wrapper">
                <div class="image-container">
                    <img src="proj1/emir.jpeg" alt="Emir">
                </div>
                <div class="image-caption">Emir of Bukhara</div>
                <div class="offset-info">B: (-49, -24) | R: (57, 17)</div>
            </div>
            <div class="image-wrapper">
                <div class="image-container">
                    <img src="proj1/church.jpeg" alt="Church">
                </div>
                <div class="image-caption">Church</div>
                <div class="offset-info">B: (-25, -4) | R: (33, -8)</div>
            </div>
            <div class="image-wrapper">
                <div class="image-container">
                    <img src="proj1/harvesters.jpeg" alt="Harvesters">
                </div>
                <div class="image-caption">Harvesters</div>
                <div class="offset-info">B: (-59, -17) | R: (65, -3)</div>
            </div>
            <div class="image-wrapper">
                <div class="image-container">
                    <img src="proj1/icon.jpeg" alt="Icon">
                </div>
                <div class="image-caption">Icon</div>
                <div class="offset-info">B: (-41, -17) | R: (48, 5)</div>
            </div>
            <div class="image-wrapper">
                <div class="image-container">
                    <img src="proj1/self_portrait.jpeg" alt="Self Portrait">
                </div>
                <div class="image-caption">Self Portrait</div>
                <div class="offset-info">B: (-79, -29) | R: (98, 8)</div>
            </div>
            <div class="image-wrapper">
                <div class="image-container">
                    <img src="proj1/three_generations.jpeg" alt="Three Generations">
                </div>
                <div class="image-caption">Three Generations</div>
                <div class="offset-info">B: (-52, -14) | R: (59, -3)</div>
            </div>
            <div class="image-wrapper">
                <div class="image-container">
                    <img src="proj1/melons.jpeg" alt="Melons">
                </div>
                <div class="image-caption">Melons</div>
                <div class="offset-info">B: (-82, -11) | R: (96, 3)</div>
            </div>
            <div class="image-wrapper">
                <div class="image-container">
                    <img src="proj1/italil.jpeg" alt="Italil">
                </div>
                <div class="image-caption">Italil</div>
                <div class="offset-info">B: (-38, -21) | R: (39, 15)</div>
            </div>
            <div class="image-wrapper">
                <div class="image-container">
                    <img src="proj1/lugano.jpeg" alt="Lugano">
                </div>
                <div class="image-caption">Lugano</div>
                <div class="offset-info">B: (-41, 16) | R: (52, -13)</div>
            </div>
            <div class="image-wrapper">
                <div class="image-container">
                    <img src="proj1/lastochikino.jpeg" alt="Lastochikino">
                </div>
                <div class="image-caption">Lastochikino</div>
                <div class="offset-info">B: (3, 2) | R: (78, -7)</div>
            </div>
            <div class="image-wrapper">
                <div class="image-container">
                    <img src="proj1/siren.jpeg" alt="Siren">
                </div>
                <div class="image-caption">Siren</div>
                <div class="offset-info">B: (-49, 6) | R: (47, -19)</div>
            </div>
        </div>

        <h2 id="additional">Additional Examples from the Collection</h2>
        <p>
            I selected three additional images from the Prokudin-Gorskii collection to test my algorithm.
        </p>
        <div class="image-grid">
            <div class="image-wrapper">
                <div class="image-container">
                    <img src="proj1/fav1.jpeg" alt="Favorite 1">
                </div>
                <div class="image-caption">Collection Image 1</div>
                <div class="offset-info">B: (-41, -5) | R: (64, -4)</div>
            </div>
            <div class="image-wrapper">
                <div class="image-container">
                    <img src="proj1/fav2.jpeg" alt="Favorite 2">
                </div>
                <div class="image-caption">Collection Image 2</div>
                <div class="offset-info">B: (-60, -28) | R: (66, 6)</div>
            </div>
            <div class="image-wrapper">
                <div class="image-container">
                    <img src="proj1/fav3.jpeg" alt="Favorite 3">
                </div>
                <div class="image-caption">Collection Image 3</div>
                <div class="offset-info">B: (-29, -1) | R: (90, -4)</div>
            </div>
        </div>



        <h2 id="bells">Bells and Whistles</h2>
        <p>
            I also implemented Sobel edge detection as an alternative alignment method. The Sobel operator detects edges in the images, 
            which can be more robust for alignment when the color channels have very different brightness distributions. However, after 
            switching to aligning both channels to the green channel (rather than blue), the improvements from Sobel edge detection were 
            not as dramatic as expected. The G channel alignment alone provided sufficiently good results for most images, including the 
            challenging Emir photograph.
        </p>

        <h2 id="summary">Results Summary</h2>
        <table class="results-table">
            <thead>
                <tr>
                    <th>Image</th>
                    <th>Resolution</th>
                    <th>Blue Offset (y, x)</th>
                    <th>Red Offset (y, x)</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Cathedral</td>
                    <td>Low</td>
                    <td>(-5, -2)</td>
                    <td>(7, 1)</td>
                </tr>
                <tr>
                    <td>Monastery</td>
                    <td>Low</td>
                    <td>(3, -2)</td>
                    <td>(6, 1)</td>
                </tr>
                <tr>
                    <td>Tobolsk</td>
                    <td>Low</td>
                    <td>(-3, -3)</td>
                    <td>(4, 1)</td>
                </tr>
                <tr>
                    <td>Church</td>
                    <td>High</td>
                    <td>(-25, -4)</td>
                    <td>(33, -8)</td>
                </tr>
                <tr>
                    <td>Emir</td>
                    <td>High</td>
                    <td>(-49, -24)</td>
                    <td>(57, 17)</td>
                </tr>
                <tr>
                    <td>Harvesters</td>
                    <td>High</td>
                    <td>(-59, -17)</td>
                    <td>(65, -3)</td>
                </tr>
                <tr>
                    <td>Icon</td>
                    <td>High</td>
                    <td>(-41, -17)</td>
                    <td>(48, 5)</td>
                </tr>
                <tr>
                    <td>Italil</td>
                    <td>High</td>
                    <td>(-38, -21)</td>
                    <td>(39, 15)</td>
                </tr>
                <tr>
                    <td>Lastochikino</td>
                    <td>High</td>
                    <td>(3, 2)</td>
                    <td>(78, -7)</td>
                </tr>
                <tr>
                    <td>Lugano</td>
                    <td>High</td>
                    <td>(-41, 16)</td>
                    <td>(52, -13)</td>
                </tr>
                <tr>
                    <td>Melons</td>
                    <td>High</td>
                    <td>(-82, -11)</td>
                    <td>(96, 3)</td>
                </tr>
                <tr>
                    <td>Self Portrait</td>
                    <td>High</td>
                    <td>(-79, -29)</td>
                    <td>(98, 8)</td>
                </tr>
                <tr>
                    <td>Siren</td>
                    <td>High</td>
                    <td>(-49, 6)</td>
                    <td>(47, -19)</td>
                </tr>
                <tr>
                    <td>Three Generations</td>
                    <td>High</td>
                    <td>(-52, -14)</td>
                    <td>(59, -3)</td>
                </tr>
                <tr>
                    <td>Collection Image 1</td>
                    <td>High</td>
                    <td>(-41, -5)</td>
                    <td>(64, -4)</td>
                </tr>
                <tr>
                    <td>Collection Image 2</td>
                    <td>High</td>
                    <td>(-60, -28)</td>
                    <td>(66, 6)</td>
                </tr>
                <tr>
                    <td>Collection Image 3</td>
                    <td>High</td>
                    <td>(-29, -1)</td>
                    <td>(90, -4)</td>
                </tr>
            </tbody>
        </table>

        <div style="text-align: center; color: #606060; margin-top: 80px; padding: 40px 0; border-top: 1px solid #2a2a2a;">
            © 2025 Sukhamrit Singh. All rights reserved.
        </div>
    </div>
</body>
</html>